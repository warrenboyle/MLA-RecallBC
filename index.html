<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BC Recall Countdown</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

```
    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
        min-height: 100vh;
        color: #fff;
        padding: 15px;
    }
    
    .container { max-width: 1200px; margin: 0 auto; }
    
    header { text-align: center; margin-bottom: 30px; }
    
    h1 {
        font-size: 1.8rem;
        margin-bottom: 10px;
        color: #e94560;
    }
    
    .subtitle { color: #94a3b8; font-size: 1rem; }
    
    .countdown-section {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 20px;
        padding: 25px;
        margin-bottom: 25px;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .countdown-title {
        text-align: center;
        margin-bottom: 20px;
        color: #e94560;
        font-size: 1.2rem;
    }
    
    .countdown-grid {
        display: flex;
        justify-content: center;
        gap: 15px;
        flex-wrap: wrap;
    }
    
    .countdown-item {
        background: linear-gradient(145deg, #1e2a4a, #162038);
        padding: 15px 20px;
        border-radius: 15px;
        text-align: center;
        min-width: 70px;
    }
    
    .countdown-number {
        font-size: 2rem;
        font-weight: bold;
        color: #e94560;
    }
    
    .countdown-label {
        color: #94a3b8;
        font-size: 0.8rem;
        text-transform: uppercase;
    }
    
    .target-date {
        text-align: center;
        margin-top: 15px;
        color: #94a3b8;
        font-size: 0.9rem;
    }
    
    .main-content {
        display: grid;
        grid-template-columns: 1fr;
        gap: 25px;
    }
    
    @media (min-width: 900px) {
        .main-content { grid-template-columns: 1fr 350px; }
        h1 { font-size: 2.5rem; }
        .countdown-number { font-size: 3rem; }
    }
    
    .voting-section, .leaderboard-section {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 20px;
        padding: 20px;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .section-title {
        font-size: 1.3rem;
        margin-bottom: 15px;
    }
    
    .party-tabs {
        display: flex;
        gap: 8px;
        margin-bottom: 15px;
        flex-wrap: wrap;
    }
    
    .party-tab {
        padding: 8px 16px;
        border: none;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
        opacity: 0.6;
    }
    
    .party-tab.active { opacity: 1; }
    .party-tab.ndp { background: #f97316; color: white; }
    .party-tab.conservative { background: #3b82f6; color: white; }
    .party-tab.green { background: #22c55e; color: white; }
    .party-tab.independent { background: #8b5cf6; color: white; }
    .party-tab.onebc { background: #ec4899; color: white; }
    
    .mla-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        gap: 8px;
        max-height: 400px;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
    }
    
    .mla-btn {
        padding: 10px 12px;
        border: none;
        border-radius: 8px;
        font-size: 0.8rem;
        text-align: left;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: rgba(255, 255, 255, 0.08);
        color: white;
    }
    
    .mla-btn:disabled { opacity: 0.5; }
    
    .mla-btn .votes {
        background: rgba(233, 69, 96, 0.3);
        padding: 2px 6px;
        border-radius: 10px;
        font-size: 0.7rem;
        min-width: 30px;
        text-align: center;
    }
    
    .leaderboard-item {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
        margin-bottom: 8px;
    }
    
    .rank { font-size: 1.3rem; font-weight: bold; width: 30px; text-align: center; }
    .rank-1 { color: #ffd700; }
    .rank-2 { color: #c0c0c0; }
    .rank-3 { color: #cd7f32; }
    
    .leader-info { flex: 1; }
    .leader-name { font-weight: 600; font-size: 0.9rem; }
    .leader-party { font-size: 0.75rem; color: #94a3b8; }
    .leader-votes { font-size: 1.1rem; font-weight: bold; color: #e94560; }
    
    .party-badge {
        display: inline-block;
        padding: 2px 6px;
        border-radius: 8px;
        font-size: 0.65rem;
        font-weight: 600;
    }
    
    .party-badge.ndp { background: #f97316; }
    .party-badge.conservative { background: #3b82f6; }
    .party-badge.green { background: #22c55e; }
    .party-badge.independent { background: #8b5cf6; }
    .party-badge.onebc { background: #ec4899; }
    
    .cooldown-notice {
        text-align: center;
        padding: 12px;
        background: rgba(233, 69, 96, 0.2);
        border-radius: 8px;
        margin-bottom: 15px;
        display: none;
    }
    
    .info-box {
        background: rgba(59, 130, 246, 0.2);
        border-radius: 8px;
        padding: 12px;
        margin-top: 15px;
        font-size: 0.85rem;
        line-height: 1.5;
    }
    
    .info-box h4 { margin-bottom: 8px; color: #60a5fa; font-size: 0.9rem; }
    
    .total-votes {
        text-align: center;
        margin-top: 15px;
        font-size: 0.85rem;
        color: #94a3b8;
    }
    
    .empty-leaderboard {
        text-align: center;
        padding: 20px;
        color: #94a3b8;
    }
</style>
```

</head>
<body>
    <div class="container">
        <header>
            <h1>BC MLA Recall Countdown</h1>
            <p class="subtitle">Vote for which MLA you'd most like to see recalled</p>
        </header>

```
    <section class="countdown-section">
        <h2 class="countdown-title">Time Until Recall Petitions Can Begin</h2>
        <div class="countdown-grid">
            <div class="countdown-item">
                <div class="countdown-number" id="days">0</div>
                <div class="countdown-label">Days</div>
            </div>
            <div class="countdown-item">
                <div class="countdown-number" id="hours">0</div>
                <div class="countdown-label">Hours</div>
            </div>
            <div class="countdown-item">
                <div class="countdown-number" id="minutes">0</div>
                <div class="countdown-label">Minutes</div>
            </div>
            <div class="countdown-item">
                <div class="countdown-number" id="seconds">0</div>
                <div class="countdown-label">Seconds</div>
            </div>
        </div>
        <p class="target-date">Target Date: <strong>April 20, 2026</strong></p>
    </section>
    
    <div class="main-content">
        <section class="voting-section">
            <h2 class="section-title">Vote for MLA to Recall</h2>
            
            <div class="cooldown-notice" id="cooldown-notice">
                Please wait <span id="cooldown-time">60</span>s before voting again
            </div>
            
            <div class="party-tabs" id="party-tabs">
                <button class="party-tab ndp active" onclick="showParty('ndp')">NDP (47)</button>
                <button class="party-tab conservative" onclick="showParty('conservative')">Conservative (39)</button>
                <button class="party-tab green" onclick="showParty('green')">Green (2)</button>
                <button class="party-tab independent" onclick="showParty('independent')">Independent (3)</button>
                <button class="party-tab onebc" onclick="showParty('onebc')">OneBC (2)</button>
            </div>
            
            <div class="mla-grid" id="mla-grid"></div>
            
            <div class="info-box">
                <h4>About BC Recall Elections</h4>
                <p>Under BC's Recall and Initiative Act, voters can petition to recall their MLA 18 months after an election. Success requires 40% of registered voters in that riding to sign within 60 days.</p>
            </div>
        </section>
        
        <section class="leaderboard-section">
            <h2 class="section-title">Top 10 to Recall</h2>
            <div id="leaderboard"><div class="empty-leaderboard">No votes yet</div></div>
            <div class="total-votes" id="total-votes"></div>
        </section>
    </div>
</div>
```

<script>
// Configuration
var SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzF9qsif0aHZNt4ST_42RU2vj_QH2ratoPVeWXVrYbJRfvGpMedh5Xi22rYukItEfQ4/exec';

// MLA Data
var MLAs = {
    ndp: [
        {name: "David Eby", riding: "Vancouver-Point Grey"},
        {name: "Adrian Dix", riding: "Vancouver-Renfrew"},
        {name: "Mike Farnworth", riding: "Port Coquitlam"},
        {name: "Brenda Bailey", riding: "Vancouver-South Granville"},
        {name: "Lisa Beare", riding: "Maple Ridge-Pitt Meadows"},
        {name: "Garry Begg", riding: "Surrey-Guildford"},
        {name: "Raj Chouhan", riding: "Burnaby-New Westminster"},
        {name: "Ravi Kahlon", riding: "Delta North"},
        {name: "Lana Popham", riding: "Saanich South"},
        {name: "Anne Kang", riding: "Burnaby-Deer Lake"},
        {name: "Sheila Malcolmson", riding: "Nanaimo-Gabriola Island"},
        {name: "Jennifer Whiteside", riding: "New Westminster-Coquitlam"},
        {name: "Grace Lore", riding: "Victoria-Beacon Hill"},
        {name: "Bowinn Ma", riding: "North Vancouver-Lonsdale"},
        {name: "Brittny Anderson", riding: "Kootenay Central"},
        {name: "Rick Glumac", riding: "Port Moody-Burquitlam"},
        {name: "Kelly Greene", riding: "Richmond-Steveston"},
        {name: "Spencer Chandra Herbert", riding: "Vancouver-West End"},
        {name: "Ravi Parmar", riding: "Langford-Highlands"},
        {name: "Mable Elmore", riding: "Vancouver-Kensington"},
        {name: "Janet Routledge", riding: "Burnaby North"},
        {name: "Josie Osborne", riding: "Mid Island-Pacific Rim"},
        {name: "Niki Sharma", riding: "Vancouver-Hastings"},
        {name: "Jagrup Brar", riding: "Surrey-Fleetwood"},
        {name: "Bob DEith", riding: "Maple Ridge-Mission"},
        {name: "Fin Donnelly", riding: "Coquitlam-Burke Mountain"},
        {name: "Jodie Wickens", riding: "Coquitlam-Maillardville"},
        {name: "Susie Chant", riding: "North Vancouver-Seymour"},
        {name: "George Anderson", riding: "Victoria-Swan Lake"},
        {name: "Jessie Sunner", riding: "Surrey-Serpentine River"},
        {name: "Jennifer Blatherwick", riding: "North Coast-Haida Gwaii"},
        {name: "Amna Shah", riding: "Surrey-City Centre"},
        {name: "Paul Choi", riding: "Burnaby East"},
        {name: "Sunita Dhir", riding: "Surrey-Newton"},
        {name: "Nina Krieger", riding: "Vancouver-Fraserview"},
        {name: "Stephanie Higginson", riding: "Ladysmith-Oceanside"},
        {name: "Dana Lajeunesse", riding: "Juan de Fuca-Malahat"},
        {name: "Diana Gibson", riding: "Oak Bay-Gordon Head"},
        {name: "Joan Phillip", riding: "Vancouver-Mount Pleasant"},
        {name: "Darlene Rotchford", riding: "Esquimalt-Colwood"},
        {name: "Christine Boyle", riding: "Vancouver-Little Mountain"},
        {name: "George Heyman", riding: "Vancouver-Fairview"},
        {name: "Henry Yao", riding: "Richmond-Queensborough"},
        {name: "Randene Neill", riding: "Powell River-Sunshine Coast"},
        {name: "Jessie Dhaliwal", riding: "Surrey-Panorama"},
        {name: "Jenn Kramer", riding: "North Island"},
        {name: "Donegal Wilson", riding: "Boundary-Similkameen"}
    ],
    conservative: [
        {name: "John Rustad", riding: "Nechako Lakes"},
        {name: "Trevor Halford", riding: "Surrey-White Rock"},
        {name: "Peter Milobar", riding: "Kamloops-Centre"},
        {name: "Bruce Banman", riding: "Abbotsford South"},
        {name: "Elenore Sturko", riding: "Surrey-Cloverdale"},
        {name: "Teresa Wat", riding: "Richmond-Bridgeport"},
        {name: "Lorne Doerkson", riding: "Cariboo-Chilcotin"},
        {name: "Aaliya Warbus", riding: "Chilliwack-Cultus Lake"},
        {name: "Kiel Giddens", riding: "Prince George-Mackenzie"},
        {name: "Sheldon Clare", riding: "Prince George-North Cariboo"},
        {name: "Rosalyn Bird", riding: "Prince George-Valemount"},
        {name: "Macklin McCall", riding: "West Kelowna-Peachland"},
        {name: "Gavin Dew", riding: "Kelowna-Mission"},
        {name: "Kristina Loewen", riding: "Kelowna Centre"},
        {name: "Harman Bhangu", riding: "Langley-Walnut Grove"},
        {name: "Misty Van Popta", riding: "Langley-Willowbrook"},
        {name: "Brent Chapman", riding: "Surrey-South"},
        {name: "Heather Maahs", riding: "Chilliwack North"},
        {name: "Chuck Chicken", riding: "Fraser-Nicola"},
        {name: "Ian Paton", riding: "Delta South"},
        {name: "Mike de Jong", riding: "Abbotsford-Mission"},
        {name: "Lawrence Mok", riding: "Richmond Centre"},
        {name: "Korky Feeney", riding: "Kamloops-North Thompson"},
        {name: "Amelia Boultbee", riding: "Salmon Arm-Shuswap"},
        {name: "Tom Shypitka", riding: "Kootenay-Rockies"},
        {name: "Claire Rathbone", riding: "Penticton-Summerland"},
        {name: "Anna Kindy", riding: "Vernon-Lumby"},
        {name: "Bryan Tepper", riding: "Courtenay-Comox"},
        {name: "Stephen Fowler", riding: "Kelowna-Lake Country-Coldstream"},
        {name: "Mike Bandstra", riding: "Abbotsford West"},
        {name: "Dennis Giesbrecht", riding: "Mission-Agassiz"},
        {name: "Larry Neufeld", riding: "Peace River North"},
        {name: "Dan Baird", riding: "Columbia River-Trail"},
        {name: "Conn Doheny", riding: "Parksville-Qualicum"},
        {name: "Donnie Rosa", riding: "Skeena"},
        {name: "Rohit Sandhu", riding: "Surrey-Green Timbers"},
        {name: "Tony Luck", riding: "Vancouver-Langara"},
        {name: "Tim Thielmann", riding: "Vernon-Monashee"},
        {name: "John Wilson", riding: "Stikine-Terrace"}
    ],
    green: [
        {name: "Jeremy Valeriote", riding: "West Vancouver-Sea to Sky"},
        {name: "Rob Botterell", riding: "Saanich North and the Islands"}
    ],
    independent: [
        {name: "John Koury", riding: "Peace River South"},
        {name: "Karin Kirkpatrick", riding: "West Vancouver-Capilano"},
        {name: "Kevin Falcon", riding: "Vancouver-Quilchena"}
    ],
    onebc: [
        {name: "Dallas Brodie", riding: "Surrey East"},
        {name: "Tara Armstrong", riding: "Kelowna-Centre"}
    ]
};

// State
var currentParty = 'ndp';
var votes = {};
var lastVoteTime = 0;
var COOLDOWN_MS = 60000;

// Load last vote time from localStorage
try {
    lastVoteTime = parseInt(localStorage.getItem('lastVoteTime')) || 0;
} catch(e) {}

// Countdown
function updateCountdown() {
    var target = new Date(2026, 3, 20, 0, 0, 0); // April 20, 2026
    var now = new Date();
    var diff = target - now;
    
    if (diff <= 0) {
        document.getElementById('days').textContent = '0';
        document.getElementById('hours').textContent = '0';
        document.getElementById('minutes').textContent = '0';
        document.getElementById('seconds').textContent = '0';
        return;
    }
    
    var days = Math.floor(diff / (1000 * 60 * 60 * 24));
    var hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    var minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
    var seconds = Math.floor((diff % (1000 * 60)) / 1000);
    
    document.getElementById('days').textContent = days;
    document.getElementById('hours').textContent = hours;
    document.getElementById('minutes').textContent = minutes;
    document.getElementById('seconds').textContent = seconds;
}

function canVote() {
    return (Date.now() - lastVoteTime) >= COOLDOWN_MS;
}

function getCooldownRemaining() {
    var remaining = Math.ceil((COOLDOWN_MS - (Date.now() - lastVoteTime)) / 1000);
    return remaining > 0 ? remaining : 0;
}

function showParty(party) {
    currentParty = party;
    var tabs = document.querySelectorAll('.party-tab');
    for (var i = 0; i < tabs.length; i++) {
        tabs[i].classList.remove('active');
        if (tabs[i].className.indexOf(party) > -1) {
            tabs[i].classList.add('active');
        }
    }
    renderMLAGrid();
}

function renderMLAGrid() {
    var grid = document.getElementById('mla-grid');
    var mlas = MLAs[currentParty];
    var html = '';
    var disabled = !canVote() ? 'disabled' : '';
    
    for (var i = 0; i < mlas.length; i++) {
        var mla = mlas[i];
        var key = mla.name + '|' + mla.riding;
        var voteCount = votes[key] || 0;
        html += '<button class="mla-btn" ' + disabled + ' onclick="vote(\'' + mla.name.replace(/'/g, '') + '\', \'' + mla.riding.replace(/'/g, '') + '\')">';
        html += '<span>' + mla.name + '</span>';
        html += '<span class="votes">' + voteCount + '</span>';
        html += '</button>';
    }
    
    grid.innerHTML = html;
}

function renderLeaderboard() {
    var leaderboard = document.getElementById('leaderboard');
    var allMLAs = [];
    var parties = ['ndp', 'conservative', 'green', 'independent', 'onebc'];
    
    for (var p = 0; p < parties.length; p++) {
        var party = parties[p];
        var mlas = MLAs[party];
        for (var i = 0; i < mlas.length; i++) {
            var mla = mlas[i];
            var key = mla.name + '|' + mla.riding;
            var voteCount = votes[key] || 0;
            if (voteCount > 0) {
                allMLAs.push({name: mla.name, riding: mla.riding, party: party, votes: voteCount});
            }
        }
    }
    
    allMLAs.sort(function(a, b) { return b.votes - a.votes; });
    var top10 = allMLAs.slice(0, 10);
    
    if (top10.length === 0) {
        leaderboard.innerHTML = '<div class="empty-leaderboard">No votes yet. Be the first!</div>';
        document.getElementById('total-votes').textContent = '';
        return;
    }
    
    var html = '';
    for (var i = 0; i < top10.length; i++) {
        var mla = top10[i];
        html += '<div class="leaderboard-item">';
        html += '<span class="rank rank-' + (i+1) + '">' + (i+1) + '</span>';
        html += '<div class="leader-info">';
        html += '<div class="leader-name">' + mla.name + '</div>';
        html += '<div class="leader-party"><span class="party-badge ' + mla.party + '">' + mla.party.toUpperCase() + '</span> ' + mla.riding + '</div>';
        html += '</div>';
        html += '<div class="leader-votes">' + mla.votes + '</div>';
        html += '</div>';
    }
    leaderboard.innerHTML = html;
    
    var total = 0;
    for (var key in votes) {
        total += votes[key];
    }
    document.getElementById('total-votes').textContent = 'Total votes: ' + total;
}

function updateCooldownNotice() {
    var notice = document.getElementById('cooldown-notice');
    var span = document.getElementById('cooldown-time');
    
    if (!canVote()) {
        notice.style.display = 'block';
        span.textContent = getCooldownRemaining();
    } else {
        notice.style.display = 'none';
        // Re-enable buttons
        var btns = document.querySelectorAll('.mla-btn');
        for (var i = 0; i < btns.length; i++) {
            btns[i].disabled = false;
        }
    }
}

function vote(name, riding) {
    if (!canVote()) {
        updateCooldownNotice();
        return;
    }
    
    var key = name + '|' + riding;
    votes[key] = (votes[key] || 0) + 1;
    lastVoteTime = Date.now();
    
    try {
        localStorage.setItem('lastVoteTime', lastVoteTime.toString());
    } catch(e) {}
    
    renderMLAGrid();
    renderLeaderboard();
    updateCooldownNotice();
    
    // Send to Google Sheets
    var img = new Image();
    img.src = SCRIPT_URL + '?action=vote&mla=' + encodeURIComponent(key) + '&_=' + Date.now();
}

function loadVotes() {
    var script = document.createElement('script');
    script.src = SCRIPT_URL + '?action=getVotes&callback=handleVotes&_=' + Date.now();
    script.onerror = function() {
        console.log('Could not load votes from server');
    };
    document.body.appendChild(script);
}

function handleVotes(data) {
    if (data && data.success && data.votes) {
        votes = data.votes;
        renderMLAGrid();
        renderLeaderboard();
    }
}

// Start everything
updateCountdown();
setInterval(updateCountdown, 1000);
setInterval(updateCooldownNotice, 1000);
renderMLAGrid();
renderLeaderboard();

// Try to load votes (won't work without JSONP but that's ok)
setTimeout(function() {
    var xhr = new XMLHttpRequest();
    xhr.open('GET', SCRIPT_URL + '?action=getVotes', true);
    xhr.onload = function() {
        try {
            var data = JSON.parse(xhr.responseText);
            if (data.success && data.votes) {
                votes = data.votes;
                renderMLAGrid();
                renderLeaderboard();
            }
        } catch(e) {}
    };
    xhr.send();
}, 500);
</script>

</body>
</html>